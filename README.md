# 斗地主记牌器

这是一个适用于中游（中国游戏）里的普通54张牌斗地主的记牌器。它能够实时跟踪游戏中剩余的牌，并帮助玩家更好地做出决策。该软件使用 Python 语言编写，使用 Pillow 库进行截图，并使用 OpenCV 库进行图片模板匹配来识别牌型。

## 功能特点

- **实时记牌**：自动识别并记录游戏中已出的牌，辅助玩家更好地做出决策。
- **悬浮窗口**：记牌器以悬浮窗口的形式显示，方便玩家随时查看。
- **多窗口**：支持单独显示上家和下家出过的牌，并且透明度和位置可调。
- **可自定义**：可以自定义各项区域坐标和模板匹配阈值，各窗口的显示位置和透明度，以及快捷键等。
- **简单易用**：界面简洁，操作简单，适合新手和老手使用。

## 软件工作原理

该软件使用 Python 语言编写，使用 Pillow 库进行截图，并使用 OpenCV 库进行图片模板匹配来识别牌型。打开记牌器后，软件会定时对屏幕进行截图，然后根据截图区域的游戏状态（如是否在等待中，是否已出牌或PASS）进行识牌和标记。状态判断是通过区域内蓝色占比（蓝色是游戏的背景颜色）和 PASS 标记的匹配来判断的。识牌是通过在截图区域中寻找提前保存好的各个牌的图片来识别的。当一个区域出牌或PASS后，自动移到下一个区域。游戏开始以及地主的位置是通过寻找“【20 张】”剩余牌数的位置来判断的。游戏结束是通过结束时上方显示三张底牌的特性来判断的。软件的程序界面用的是 Tkinter 库编写的。

## 如何使用

请从 [Release](https://github.com/FlysonBot/poker-counter/releases) 页面下载最新版本的软件，并将其解压到任意位置。软件的启动程序名为 `poker-counter.exe`。你可以新建一个桌面快捷方式来快速启动软件。更多选项可以在 `config.yaml` 中进行自定义。

## 使用条件和注意事项

软件对各区域的位置极度敏感，你大概率需要手动调整区域坐标以使其正常工作。默认的配置文件是为 **1680x1050** 分辨率的游戏窗口设计的，并假设游戏全屏且任务栏显示。如果以上任意情况与你不同，请手动修改 `config.yaml` 中的区域坐标以使其正常工作。如果你的牌型数字大小不同（约20x32像素），你可能还需要修改模板图像的大小。

## 配置文件修改指南

配置文件为 YAML 格式，位于软件目录下的 `config.yaml` 文件。其中包含了游戏区域坐标、模板匹配阈值、日志路径等配置。配置文件已添加大量注释，可以帮助你更好地了解和修改配置文件。修改时，请注意截图区域的宽度和高度不能小于模板图像的宽高，并且一定要包含 PASS 标记出现的位置，否者记牌器可能无法正常工作。为了更加精确的识别，建议不要把截图区域设的太小（对所有区域都是如此）。同一窗口位置的同一坐标不能同时使用 CENTER 和 OFFSET 字段。日志级别平时建议设在 DEBUG 或 INFO。如果出了问题，可以设为 TRACE 级别以捕捉更多细节。

## 负责任地使用软件

该软件设计的初衷是辅助帮助记忆力较差的长者更好地体验游戏并发挥自身的智力。请不要以违反游戏使用条款的方式使用该软件。

**该软件仅供学习和研究使用，不得用于商业用途。**

## 有问题或建议？

如果你有任何问题或建议，欢迎在 [Issues](https://github.com/FlysonBot/poker-counter/issues) 中提出。

如果你在使用的过程中遇到任何错误提示，请将日志文件附加到 Issues 中，并详细描述问题出现前后的情况。如果遇到识别出错的问题，请务必上传屏幕录屏和配置文件到 Issues 中。这些问题往往口头描述很难描述清楚，而录屏和配置可以让问题更加一幕了然。对于屏幕录屏，可以尝试 Windows 自带的游戏模式下的屏幕录制功能。如果不管用，可以下载如 Bandicam 等第三方软件来录屏。

## 欢迎分享和奉献

喜欢我的项目？欢迎分享和奉献，让更多人能够使用它。为这个项目加星星可以让更多的人看到这个项目。

## 开发人员说明

如果你想为该项目做出贡献，你可以按照以下推荐的方式配置开发环境：

1. 安装 uv 作为 Python 的包管理器：

   ```bash
   pip install uv
   ```

2. 从 GitHub 上 Fork 本项目，然后克隆到本地：

   ```bash
   git clone https://github.com/your-username/poker-counter.git
   ```

3. 用 uv 在项目目录下创建一个新的 Python 3.12 虚拟环境：

   ```bash
   uv venv --python 3.12
   ```

4. 激活虚拟环境：

   ```bash
   .venv/bin/activate
   ```

5. 在虚拟环境中安装项目依赖：

   ```bash
   uv sync
   ```

完成啦！现在你可以在你的 IDE 中进行开发了。记得选择 .venv/bin/python3 作为你的 Python 解释器。如需编译该程序，请使用 PyInstaller 如下：

1. 安装 PyInstaller：

   ```bash
   uv pip install pyinstaller
   ```

2. 编译该程序：

   ```bash
   pyinstaller main.spec
   ```

完成后，你将在 dist 目录下找到编译好的程序。
